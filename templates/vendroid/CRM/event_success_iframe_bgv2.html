{% extends "base_bawf_blank.html" %}
{% load pagination_tags %}
{% load static %}
{% load myfilters %}
{% load humanize %}
{% block content %}
    {#    <script src="{% static "js/bootstrap.min.js" %}"></script>#}
    {#    <script src="{% static "js/jquery-ui.min.js" %}"></script>#}
    {##}
    {#    <script src="{% static "vendroid/plugins/daterangepicker/daterangepicker.js" %}"></script>#}
    <link href={% static "css/jquery.datetimepicker.css" %} rel="stylesheet" type="text/css" media="all"/>
    <link href={% static "css/chosen.css" %} rel="stylesheet" type="text/css" media="all"/>
    <script type="text/javascript" src="{% static "js/jquery.datetimepicker.js" %}"></script>
    {#    <script>#}
    {#        parent.location.href = "http://bayareaweddingfairs.com/bride-registration-success/"#}
    {#    </script>#}

    {#    <link href="{% static "vendroid/plugins/tagsInput/jquery.tagsinput.css" %}" rel="stylesheet" type="text/css">#}
    {#    <link href="{% static "vendroid/plugins/bootstrap-switch/bootstrap-switch.css" %}" rel="stylesheet" type="text/css">#}
    {#    <link href="{% static "vendroid/plugins/daterangepicker/daterangepicker-bs3.css" %}" rel="stylesheet" type="text/css">#}
    {#    <link href="{% static "vendroid/plugins/bootstrap-timepicker/bootstrap-timepicker.min.css" %}" rel="stylesheet" type="text/css">#}
    {#    <link href="{% static "vendroid/plugins/colorpicker/css/colorpicker.css" %}" rel="stylesheet" type="text/css">#}


    <!-- Specific Page Scripts Put Here -->

    {#    <script type="text/javascript" src='plugins/jquery-ui/jquery-ui.custom.min.js'></script>#}
    <style>
        .red {
            color: red;
        }

        textarea {
            height: 80px;
        }
        @media only screen and (max-width: 500px) {
            .font-small-policy {
                font-size: 2px;
            }
        }
    </style>
    <div class="vd_body">
        <!-- Header Start -->
        {#        {% include "vendroid/partial/_header.html" %}#}
        <!-- Header Ends -->
        <div class="content">
            <div class="">
                {#                {% include "vendroid/CRM/partial/_sidebar.html" %}#}
                <div class="clearfix"></div>

                <!-- Middle Content Start -->

                <div class="">
                    <div class="">
                        <div class=" clearfix">

                            <!-- vd_head-section -->

                            <div class="clearfix">

                                <!-- vd_title-section -->

                                <div class="clearfix" style="margin-bottom: 0px; padding-bottom: 0px;">

                                    <div class="row">
                                        <div class="col-md-12 col-xs-12" style="padding:0px;">
                                            <div class="panel widget" style="margin:0px;">
                                                <div class="panel-body" style="padding:0px; height:3500px;">
                                                    {#                    <h2>Nav <span class="font-semibold">Tabs</span></h2>#}
                                                    {#                    <ul class="nav nav-tabs">#}
                                                    {##}
                                                    {##}
                                                    {#                    </ul>#}
                                                    <br>

                                                    <div class="tab-content">

                                                        {% if successMessage %}
                                                            <div class="flashes">
                                                                <div class="alert alert-success">{{ successMessage }}</div>
                                                            </div>
                                                        {% endif %}
                                                        {% if error_message %}
                                                            <div class="flashes">
                                                                <div class="alert alert-danger">{{ error_message }}</div>
                                                            </div>
                                                        {% endif %}
                                                        <div class="tab-pane active" id="privacy">
                                                            <div class="col-md-12">
                                                                {#                                                                <img src="http://bayareaweddingfairs.com/wp-content/uploads/2016/01/logo-new-02.png"#}
                                                                {#                                                                     width="20%"/><br/>#}

                                                                <div class="clearfix"></div>
                                                                <br/>

                                                                <div class="text-center">
                                                                    <img src="http://bayareaweddingfairs.com/wp-content/themes/wedding-wp/images/rose/floral.png" style="margin-bottom: 20px;" />
{#                                                                    {% if not hide_thanks %}#}
                                                                        <h2 style="color: rgb(185, 76, 112);margin-bottom:20px;">Save time and money and purchase tickets now !</h2>
{#                                                                    {% endif %}#}
{#                                                                    <h4>Save time and money and purchase tickets now !</h4>#}
                                                                </div>
                                                                <form method="post" action="" id="payment-form" >
                                                                    {% csrf_token %}
                                                                    <div class="col-md-6 col-md-offset-3 col-xs-12" style="font-size: 15px;">
                                                                        <div >
                                                                            {#                                                                <div class="panel-heading" style="background-color: #ba8c00;">#}
                                                                            {#                                                                    <h3 class="panel-title" style="color: white;">  Tickets </h3>#}
                                                                            {#                                                                </div>#}
                                                                            <div class="table-responsive">
                                                                                <select class="form-control" id="id_event" name="event">
                                                                                    <option value="0">Select Wedding Fair</option>
                                                                                    {% for e in event %}
                                                                                        <option value="{{ e.id }}" data-date="{{ e.date }}">{{ e.name }} {{ e.date }}</option>

                                                                                    {% endfor %}
                                                                                </select>
                                                                                <input hidden id="0__price" value="0" />
                                                                                    <input hidden id="0__earlybird_ticket" value="0" />
                                                                                    <input hidden id="0__group_ticket" value="0" />
                                                                                    <input hidden id="0__name" value="Select an event" />
                                                                                {% for e in event %}
                                                                                    <input hidden id="{{ e.id }}__price" value="{{ e.amount }}" />
                                                                                    <input hidden id="{{ e.id }}__earlybird_ticket" value="{{ e.earlybird_ticket }}" />
                                                                                    <input hidden id="{{ e.id }}__group_ticket" value="{{ e.group_ticket }}" />
                                                                                    <input hidden id="{{ e.id }}__name" value="{{ e.name }} - {{ e.date }}" />
                                                                                {% endfor %}
                                                                                <div>
                                                                                    <h4 class="col-md-12 text-left" style="margin-top: 15px;margin-bottom:15px;">
                                                                                        Event: <a id="event_name">{{ event.name }} - {{ event.date|date:"D, M d Y" }}</a>
                                                                                    </h4>

                                                                                    <div id="standard_div">
                                                                                    <div class="col-md-12 text-left" >
                                                                                        STANDARD ADMISSION:  <select style="width:80px;display: inline;" data-ga-interaction-id="event-quantity" id="id_form-0-quantity" name="quantityTickets">
                                                                                        <option value="0" selected="selected">0</option>
                                                                                        <option value="1">1</option>
                                                                                        <option value="2">2</option>
                                                                                        <option value="3">3</option>
                                                                                        <option value="4">4</option>
                                                                                        <option value="5">5</option>
                                                                                        <option value="6">6</option>
                                                                                        <option value="7">7</option>
                                                                                        <option value="8">8</option>
                                                                                        <option value="9">9</option>
                                                                                        <option value="10">10</option>
                                                                                        <option value="11">11</option>
                                                                                        <option value="12">12</option>
                                                                                        <option value="13">13</option>
                                                                                        <option value="14">14</option>
                                                                                        <option value="15">15</option>
                                                                                        <option value="16">16</option>
                                                                                        <option value="17">17</option>
                                                                                        <option value="18">18</option>
                                                                                        <option value="19">19</option>
                                                                                        <option value="20">20</option>
                                                                                    </select>
                                                                                        <div class="clearfix"></div>
                                                                                    </div>
                                                                                    <div class="col-md-12 text-left" style="margin-bottom:15px;">

                                                                                        Price: <a id="event_amount">{{ event.name }} - {{ event.date|date:"D, M d Y" }}</a>
                                                                                    </div>
                                                                                    </div>

                                                                                    <div id="earlybird_div">

                                                                                        <div class="col-md-12 text-left">
                                                                                            EARLY BIRD DISCOUNTED ADMISSION:  <select style="width:80px;display: inline;" data-ga-interaction-id="earlybird-event-quantity" id="id_form-earlybird-quantity" name="earlybirdTickets">
                                                                                            <option value="0" selected="selected">0</option>
                                                                                            <option value="1">1</option>
                                                                                            <option value="2">2</option>
                                                                                            <option value="3">3</option>
                                                                                            <option value="4">4</option>
                                                                                            <option value="5">5</option>
                                                                                            <option value="6">6</option>
                                                                                            <option value="7">7</option>
                                                                                            <option value="8">8</option>
                                                                                            <option value="9">9</option>
                                                                                            <option value="10">10</option>
                                                                                            <option value="11">11</option>
                                                                                            <option value="12">12</option>
                                                                                            <option value="13">13</option>
                                                                                            <option value="14">14</option>
                                                                                            <option value="15">15</option>
                                                                                            <option value="16">16</option>
                                                                                            <option value="17">17</option>
                                                                                            <option value="18">18</option>
                                                                                            <option value="19">19</option>
                                                                                            <option value="20">20</option>
                                                                                        </select>
                                                                                            <div class="clearfix"></div>
                                                                                        </div>
                                                                                        <div class="col-md-12 text-left"  style="margin-bottom:15px;">
                                                                                            Price: <a id="earlybirds_amount">{{ event.name }} - {{ event.date|date:"D, M d Y" }}</a>
                                                                                        </div>
                                                                                    </div>



                                                                                    <div id="group_div">

                                                                                        <div class="col-md-12 text-left">
                                                                                            GROUP DISCOUNTED TICKETS (4+):  <select style="width:80px;display: inline;" data-ga-interaction-id="group-event-quantity" id="id_form-group-quantity" name="groupTickets">
                                                                                            <option value="0" selected="selected">0</option>
                                                                                            <option value="4">4</option>
                                                                                            <option value="5">5</option>
                                                                                            <option value="6">6</option>
                                                                                            <option value="7">7</option>
                                                                                            <option value="8">8</option>
                                                                                            <option value="9">9</option>
                                                                                            <option value="10">10</option>
                                                                                            <option value="11">11</option>
                                                                                            <option value="12">12</option>
                                                                                            <option value="13">13</option>
                                                                                            <option value="14">14</option>
                                                                                            <option value="15">15</option>
                                                                                            <option value="16">16</option>
                                                                                            <option value="17">17</option>
                                                                                            <option value="18">18</option>
                                                                                            <option value="19">19</option>
                                                                                            <option value="20">20</option>
                                                                                        </select>
                                                                                            <div class="clearfix"></div>
                                                                                        </div>
                                                                                        <div class="col-md-12 text-left" style="margin-bottom:15px;">
                                                                                            Price: <a id="group_amount">{{ event.name }} - {{ event.date|date:"D, M d Y" }}</a>
                                                                                        </div>


                                                                                    </div>
                                                                                    <div class="clearfix"></div>


                                                                                </div>
                                                                                {#                                                                    <table class="table table-hover">#}
                                                                                {#                                                                        <thead>#}
                                                                                {#                                                                        <tr>#}
                                                                                {#                          <th>#</th>#}
                                                                                {#                                                                            <th>EVENT</th>#}
                                                                                {#                                                                            <th>TICKET TYPE</th>#}
                                                                                {#                                                                            <th>PRICE</th>#}
                                                                                {#                                                                            <th>QTY</th>#}
                                                                                {#                          <th>Status</th>#}
                                                                                {#                          <th>Action</th>#}
                                                                                {#                                                                        </tr>#}
                                                                                {#                                                                        </thead>#}
                                                                                {#                                                                        <tbody>#}
                                                                                {#                                                                        <tr>#}
                                                                                {#                          <td>1</td>#}
                                                                                {#                                                                            <td id="event_name">{{ event.name }} - {{ event.date|date:"D, M d Y" }}</td>#}
                                                                                {#                                                                            <td>Bride / Groom</td>#}
                                                                                {#                                                                            <td class="center" id="event_amount">{{ event.amount }}</td>#}
                                                                                {#                                                                            <td class="center">#}
                                                                                {#                                                                                <select style="width: 40px;" class="form-control" data-ga-interaction-id="event-quantity" id="id_form-0-quantity" name="quantityTickets">#}
                                                                                {#                                                                                    <option value="0" selected="selected">0</option>#}
                                                                                {#                                                                                    <option value="1">1</option>#}
                                                                                {#                                                                                    <option value="2">2</option>#}
                                                                                {#                                                                                    <option value="3">3</option>#}
                                                                                {#                                                                                    <option value="4">4</option>#}
                                                                                {#                                                                                    <option value="5">5</option>#}
                                                                                {#                                                                                    <option value="6">6</option>#}
                                                                                {#                                                                                    <option value="7">7</option>#}
                                                                                {#                                                                                    <option value="8">8</option>#}
                                                                                {#                                                                                    <option value="9">9</option>#}
                                                                                {#                                                                                    <option value="10">10</option>#}
                                                                                {#                                                                                    <option value="11">11</option>#}
                                                                                {#                                                                                    <option value="12">12</option>#}
                                                                                {#                                                                                    <option value="13">13</option>#}
                                                                                {#                                                                                    <option value="14">14</option>#}
                                                                                {#                                                                                    <option value="15">15</option>#}
                                                                                {#                                                                                    <option value="16">16</option>#}
                                                                                {#                                                                                    <option value="17">17</option>#}
                                                                                {#                                                                                    <option value="18">18</option>#}
                                                                                {#                                                                                    <option value="19">19</option>#}
                                                                                {#                                                                                    <option value="20">20</option>#}
                                                                                {#                                                                                </select></td>#}
                                                                                {#                                                                        </tr>#}
                                                                                {##}
                                                                                {#                                                                        </tbody>#}
                                                                                {#                                                                    </table>#}
                                                                                {#                      <br />#}

                                                                            </div>

                                                                            <div class="col-md-12" style="padding:0px;">
                                                                               <div class="col-md-8 col-sm-8 col-xs-10 np">
                                                                                    <input style="width: 96%" type="text" id="promocode" class="form-control pull-left" maxlength="255" name="promocode" placeholder="Type promocode here to get discount" />
                                                                                   <div class="clearfix"></div>
                                                                               </div>
                                                                                <div class="col-md-4 col-sm-4 col-xs-2 np">
                                                                                    <input type="button" class="btn vd_btn btn-brown pull-left"   id="apply_promocode" name="apply_promocode" value="Apply" />
                                                                                </div>
                                                                                <div class="clearfix"></div>
                                                                               <div class="col-md-12 col-sm-12 col-xs-12 np">
                                                                                    <div class="clearfix"></div>
                                                                                <div id="error_promotion" style="color: red"></div>
                                                                                <div id="success_promotion" style="color: green"></div>

                                                                               </div>

                                                                            </div><div class="clearfix"></div>
                                                                            <div class="col-md-12 " style="padding:0px;margin-top:15px;">
{#                                                                                <hr />#}
                                                                                <div class="col-md-12 text-left" style="padding:0px;">
                                                                                    <h4>                            Total: $<p style="display: inline;" id="total_ticket_price">0</p>
                                                                                    </h4>
                                                                                </div>
{#                                                                                <hr />#}
                                                                                {#                                                                                <div class="col-md-3 text-left">#}
                                                                                {##}
                                                                                {##}
                                                                                {#                                                                                </div>#}

                                                                                <input  type="hidden" name="hidden_total" value="$xx" id="hidden_total"/>
                                                                            </div>


                                                                        </div>
                                                                        <!-- Panel Widget -->

                                                                        <div class="panel widget">
                                                                             <hr />

                                                                            {{ form.as_p  }}

                                                                            {#                                                                <input type="hidden" name="stripe_token" id="stripe_token">#}
                                                                            <input type="hidden" name="total_amount" id="total_amount" />
                                                                            <input type="hidden" name="stripe_token" id="stripe_token" />
                                                                            <input type="hidden" name="event_date" id="event_date" />
                                                                            <div id="error_email" style="color:red"></div>
                                                                             <p style="font-size:20px;color:grey;">
                                                                                    <input id="agreement_check" type="checkbox" required /> I agree to the terms & conditions stated above
                                                                                    <br />
                                                                                <div id="agree_error" style="color:red;"></div>
                                                                                </p>
                                                                            <input style="text-transform: uppercase; background-color: #db2681; font-size: 18px; border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; display: inline-block; margin: 0; text-align: center; text-decoration: none; font-weight: bold; color: #ffffff; font-family: arial,sans-serif !important; padding: 10px 20px;" type="submit" class="btn vd_btn btn-brown" value="BUY NOW" id="submit-form" />

                                                                            <div class="text-left  font-small-policy" style="margin-top:10px;">
                                                                                <b style="font-size: 15px;">
                                                                                    Refund Policy:
                                                                                </b>
                                                                                <p style="font-size: 15px;">Tickets are non-refundable. However, tickets can be transferred to other events only if approved by Bay Area Wedding Fairs.</p>

                                                                                <b style="font-size: 15px;">Waiver Release</b>

                                                                                <p style="font-size: 15px;">Purchasing this Ticket provides entrance for one person into a Bay Area Wedding Fair. All Ticket sales are final unless pre-approved by Bay Area Wedding Fairs. Bay Area Wedding Fairs reserves the right to permit or refuse entrance for any reason it deems detrimental to the Event. Once the attendee enters the Event they acknowledge that the attendee/ticket holder is not covered by any liability policy or entity and agrees to hold Bay Area Wedding Fairs harmless for any physical, emotional, financial or any other form of damages as a result of attending the Event. Individual Exhibitors have sole responsibility of their personal, physical, promotional or financial interactions with each attendee/ticket holder. Bay Area Wedding Fairs may advertise certain attractions or promotions that due to circumstances beyond its control may not be available at any specific event. Last Minute Changes are due to exhibitor/provider failures and not Bay Area Wedding Fairs. No Refunds or remedies are available in these cases. Attendees must obey all laws and may be subject to the host property’s security requests. Failure to adhere to these requests and/or failure to abide by the rules stated herein may result in ejection from the event with no possibility of refund. Enjoy the Event!</p>


                                                                            </div>

                                                                        </div>

                                                                    </div>
                                                                </form>
                                                                {#                                                                <p style="margin-top:25px;margin-bottom:25px;">#}
                                                                {#                                                                    <a style="text-transform: uppercase; background-color: #db2681; font-size: 18px; border-radius: 3px; -moz-border-radius: 3px; -webkit-border-radius: 3px; display: inline-block; margin: 0; text-align: center; text-decoration: none; font-weight: bold; color: #ffffff; font-family: arial,sans-serif !important; padding: 10px 20px;" href="https://bayareaweddingfairs.ticketleap.com/" target="_blank">Click Here to Get Tickets</a>#}
                                                                {#                                                                </p>#}
                                                                <div class="clearfix"></div>

                                                                {#                                                                <hr/>#}
                                                                {#                                                                <h4>We will get back to you soon. In the meantime, if you have any questions, please email at info@bayareaweddingfairs.com</h4>#}
                                                            </div>

                                                        </div>

                                                    </div>
                                                </div>
                                                {#                                                <br><br>#}


                                            </div>
                                        </div>
                                        <!-- Panel Widget -->
                                    </div>
                                    <!-- col-md-6 -->

                                </div>
                                <!-- row -->

                            </div>
                            <!-- .vd_content-section -->

                        </div>
                        <!-- .vd_content -->
                    </div>
                    <!-- .vd_container -->
                </div>
                <!-- .vd_container -->
            </div>
            <!-- .vd_content-wrapper -->

            <!-- Middle Content End -->

        </div>
        <!-- .container -->

        <!-- .content -->

        {#        <!-- Footer Start -->#}
        {#        <footer class="footer-1" id="footer">#}
        {#            <div class="vd_bottom ">#}
        {#                <div class="container">#}
        {#                    <div class="row">#}
        {#                        <div class=" col-xs-12">#}
        {#                            <div class="copyright">#}
        {#                                Copyright &copy;2015 YapJoy Inc. All Rights Reserved#}
        {#                            </div>#}
        {#                        </div>#}
        {#                    </div>#}
        {#                    <!-- row -->#}
        {#                </div>#}
        {#                <!-- container -->#}
        {#            </div>#}
        {#        </footer>#}
        {#        <!-- Footer END -->#}


    </div>




{% endblock content %}
{% block script %}

    <script src="https://js.stripe.com/v1/" type="text/javascript"></script>
    <script>
        var event_price =0;
        var earlybird = 0;
        var group=0;
        var total_value = 0;
        var standard_quantity = 0;
        var earlybird_quantity = 0;
        var group_quantity = 0;
        var total = $('#total_ticket_price');
        var hidden_total = $('#hidden_total');
        $("#standard_div").hide()
        function get_event(){
            var event_id = $('#id_event').val();

            event_price = $('#'+event_id+'__price').val();
            earlybird = $('#'+event_id+'__earlybird_ticket').val();
            group = $('#'+event_id+'__group_ticket').val();


            var event_name = $('#'+event_id+'__name').val();

            $('#event_amount').html(event_price);
            $('#earlybirds_amount').html(earlybird);
            $('#group_amount').html(group);

            $('#event_name').html(event_name);

{#            $('#id_form-0-quantity').get(0).selectedIndex = 0#}
            $('#id_form-earlybird-quantity ').get(0).selectedIndex = 0
            $('#id_form-group-quantity ').get(0).selectedIndex = 0
        }
        function event_selection_function(){
             get_event();
             $("#group_div").show();
                $("#earlybird_div").show();
                $("#standard_div").show();
            if (earlybird <= 0.0)
            {
                $("#earlybird_div").hide();
            }
            if (event_price <= 0.0)
            {
                $("#standard_div").hide();
            }
            if(group <= 0.0)
            {
                $("#group_div").hide();
            }
{#            else {#}
{#               #}
{#            }#}
            $('input[name="hidden_total"]').val('');
            total_value = 0;
            total.text(total_value);
{#            standard_quantity = $('#id_form-0-quantity :selected').text();#}
            earlybird_quantity = $('#id_form-earlybird-quantity :selected').text();
            group_quantity = $('#id_form-group-quantity :selected').text();
            console.log(standard_quantity, earlybird_quantity, group_quantity);
            calculateAmount(standard_quantity, earlybird_quantity, group_quantity);
        }
        $('#id_event').change(function(){

           event_selection_function();
           var event_date = $('#id_event').find(':selected').data('date');
           $("#event_date").val(event_date);
           console.log('event: ', event_date, $(this));

            var m_names = new Array("Jan. ", "Feb. ", "Mar. ",
                "Apr. ", "May. ", "Jun. ", "Jul. ", "Aug. ", "Sep. ",
                "Oct. ", "Nov. ", "Dec. ");

            var d = new Date();
            var curr_date = d.getDate();
            var curr_month = d.getMonth();
            var curr_year = d.getFullYear();
            var current_date = m_names[curr_month] + curr_date +', ' +curr_year;
            console.log('date: ', current_date, event_date);
            if(current_date == event_date){
                $("#standard_div").show();
                $("#earlybird_div").hide();
                $("#group_div").hide()

            }else{
                $("#standard_div").hide();
                 $("#earlybird_div").show();
                $("#group_div").show()
            }


        });
        function calculateAmount(standard_quantity, earlybird_quantity, group_quantity) {

            total_value = (standard_quantity * event_price).toFixed(2);
            total_value = +total_value + +(earlybird_quantity * earlybird).toFixed(2);
            console.log("earlybird",earlybird,+total_value + +(earlybird_quantity * earlybird).toFixed(2));
            total_value = +total_value + +(group_quantity * group).toFixed(2);


            $('input[name="hidden_total"]').val(total_value);
            console.log('total: ',hidden_total.val());
            total.text(total_value);
            console.log("Q change: ",total);
        }

        $(document).ready(function () {
            event_selection_function()
            get_event();
            $("#id_email").resetForm();



            console.log('total ready: ', total.text(), hidden_total.val());
            $('#error_email').html('');


            $("#id_form-0-quantity").change(function () {
                standard_quantity = $('#id_form-0-quantity :selected').text();
                earlybird_quantity = $('#id_form-earlybird-quantity :selected').text();
                group_quantity = $('#id_form-group-quantity :selected').text();
                console.log(standard_quantity, earlybird_quantity, group_quantity)
                calculateAmount(standard_quantity, earlybird_quantity, group_quantity);
            });

            $("#id_form-earlybird-quantity").change(function () {
                var selected;
                standard_quantity = $('#id_form-0-quantity :selected').text();
                earlybird_quantity = $('#id_form-earlybird-quantity :selected').text();
                group_quantity = $('#id_form-group-quantity :selected').text();

                calculateAmount(standard_quantity, earlybird_quantity, group_quantity);
            });

            $("#id_form-group-quantity").change(function () {
                standard_quantity = $('#id_form-0-quantity :selected').text();
                earlybird_quantity = $('#id_form-earlybird-quantity :selected').text();
                group_quantity = $('#id_form-group-quantity :selected').text();

                calculateAmount(standard_quantity, earlybird_quantity, group_quantity);


            });



            $('#apply_promocode').click(function () {

                $('#success_promotion').html('');
                $('#error_promotion').html('');

                var promotion = $("#promocode").val();
                {#                alert(total.text());#}
                if (total.text() != '0'){
                    if(promotion != ''){

                        $.ajax({
                            url: "/bayareaweddingfairs/tickets/promocode/",
                            type: "GET",
                            data: {
                                'promocode': promotion,
                                'total_text':total.text(),
                                'quantity': $('#id_form-0-quantity :selected').text(),

                            },

                            success: function (data) {
                                console.log('in error promo ajax: ', data);
                                if (data['response'] == 'error'){

                                    console.log('in error promo ajax');
                                    $('#error_promotion').html('Promotion Code is not Valid');

                                }
                                if(data['response'] == 'success'){
                                    console.log('in success promo ajax');
                                    $('#success_promotion').html('Promotion code is applied successfully, total amount is reduced to: '+ (data['discount']).toFixed(2));
                                    total.text((data['discount']).toFixed(2));
                                    $(this).prop('disabled', true);
                                    $('#apply_promocode').attr('disabled', 'disabled');
                                    $('#apply_promocode').val('Applied');
                                }
                            },

                            error: function(error) {
                                console.log("error: "+error.message);

                            }
                        })
                    }
                    else{
                        $('#error_promotion').html('Please Enter the Promotion Code');
                    }
                }
                else {
                    $('#error_promotion').html('Please first select the quantity ');
                }

            });

            $('#submit-form').click(function(event) {
                {#                event.preventDefault();#}
                //Stripe.setPublishableKey('pk_test_tZdpLY6bm1aDvhy9tBdfyMeV');
                var email = $('#id_email').val();
                var phone = $('#id_phone').val();
                var number = $('#id_number').val();
                var checked_box = $('#agreement_check').is(":checked");

                if((email == '')) {
                    event.preventDefault();
                    {#                    $('#id_email').prop('required',true);#}
                    $('#error_email').html('Email is required');
                    return false
                }
                if((number == '')) {
                    event.preventDefault();
                    {#                    $('#id_number').prop('required',true);#}
                    $('#error_email').html('Card Number is required');
                    return false
                }
                if((phone == '')) {

                    {#                    $('#id_phone').prop('required',true);#}
                    $('#error_email').html('Phone is required');
                    return false
                }
                if(total.text() == '0'){
                    event.preventDefault();
                    $('#error_email').html('Please Select the Quantity ');
                    return false
                }
                if(checked_box == false){
                    event.preventDefault();
                    $('#error_email').html('Please accept the terms and conditions. ');
                    return false
                }

                else {
                    $("#stripe-error-message").html("");
                    if ($("#id_number").length == 1) {
                        var key = '{{ pub_key }}';
                        Stripe.setPublishableKey(key);
                        {#                        $('#submit-form').attr('disabled','disabled');#}
                        // alert('inside');
                        var form = this;
                        var card = {
                            number: $("#id_number").val(),
                            expMonth: $("#id_month").val(),
                            expYear: $("#id_year").val(),
                            {#                    cvc: $("#id_verification_value").val()#}
                        };

                        Stripe.card.createToken(card, function (status, response) {

                            {#                            alert(response);#}
                            if (status === 200) {
                                console.log(status, response);
                                //jQuery("#credit-card-errors").hide();
                                //jQuery("#last_4_digits").val(response.card.last4);
                                $("#stripe_token").val(response.id);
                                //jQuery('#setupPayment').prop('disabled', false);
                                {#                        $('#submit-invoice').removeAttr('disabled');#}
                                {#                                return#}
                                $("#payment-form").submit();
                            } else {
                                alert(response.error.message)
                                console.log(response.error);
                                console.log(response.error.param);
                                $("#error_email").text(response.error.message);
                                {#                                $('#submit-form').removeAttr('disabled');#}
                            }
                        });
                        return false;
                    }else{
                        alert('in else')
                    }
                }

                $('#error_email').html('Your Ticket is reserved you will get the Email on provided email address');
                $('#error_email').css("color",'green')

            });

        });


    </script>

{% endblock script %}